<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
      <title>Interactions </title>
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <meta name="title" content="Interactions ">
      
      <link rel="icon" href="../../favicon.ico">
      <link rel="stylesheet" href="../../public/docfx.min.css">
      <link rel="stylesheet" href="../../public/main.css">
      <meta name="docfx:navrel" content="../../toc.html">
      <meta name="docfx:tocrel" content="../../FusionApiDev/toc.html">
      
      
      
      
      <meta name="docfx:docurl" content="https://github.com/ecell/ECell_Dive/blob/main/DocFX/articles/Dev/about_UI.md/#L1">
      <meta name="loc:inThisArticle" content="In this article">
      <meta name="loc:searchResultsCount" content="{count} results for &quot;{query}&quot;">
      <meta name="loc:searchNoResults" content="No results for &quot;{query}&quot;">
      <meta name="loc:tocFilter" content="Filter by title">
      <meta name="loc:nextArticle" content="Next">
      <meta name="loc:prevArticle" content="Previous">
      <meta name="loc:themeLight" content="Light">
      <meta name="loc:themeDark" content="Dark">
      <meta name="loc:themeAuto" content="Auto">
      <meta name="loc:changeTheme" content="Change theme">
      <meta name="loc:copy" content="Copy">
  </head>

  <script type="module" src="./../../public/docfx.min.js"></script>

  <script>
    const theme = localStorage.getItem('theme') || 'auto'
    document.documentElement.setAttribute('data-bs-theme', theme === 'auto' ? (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light') : theme)
  </script>


  <body class="tex2jax_ignore" data-layout="" data-yaml-mime="">
    <header class="bg-body border-bottom">
      <nav id="autocollapse" class="navbar navbar-expand-md" role="navigation">
        <div class="container-xxl flex-nowrap">
          <a class="navbar-brand" href="../../index.html">
            <img id="logo" class="svg" src="../../logo.svg" alt="">
            
          </a>
          <button class="btn btn-lg d-md-none border-0" type="button" data-bs-toggle="collapse" data-bs-target="#navpanel" aria-controls="navpanel" aria-expanded="false" aria-label="Toggle navigation">
            <i class="bi bi-three-dots"></i>
          </button>
          <div class="collapse navbar-collapse" id="navpanel">
            <div id="navbar">
            </div>
          </div>
        </div>
      </nav>
    </header>

    <main class="container-xxl">
      <div class="toc-offcanvas">
        <div class="offcanvas-md offcanvas-start" tabindex="-1" id="tocOffcanvas" aria-labelledby="tocOffcanvasLabel">
          <div class="offcanvas-header">
            <h5 class="offcanvas-title" id="tocOffcanvasLabel">Table of Contents</h5>
            <button type="button" class="btn-close" data-bs-dismiss="offcanvas" data-bs-target="#tocOffcanvas" aria-label="Close"></button>
          </div>
          <div class="offcanvas-body">
            <nav class="toc" id="toc"></nav>
          </div>
        </div>
      </div>

      <div class="content">
        <div class="actionbar">
          <button class="btn btn-lg border-0 d-md-none" style="margin-top: -.65em; margin-left: -.8em" type="button" data-bs-toggle="offcanvas" data-bs-target="#tocOffcanvas" aria-controls="tocOffcanvas" aria-expanded="false" aria-label="Show table of contents">
            <i class="bi bi-list"></i>
          </button>

          <nav id="breadcrumb"></nav>
        </div>

        <article data-uid="">

<p>The User Interface (UI) of the project is in a state of &quot;means to an end&quot;. It has been tweaked enough to work and it is not very well organized.</p>
<h2 id="interactions">Interactions</h2>
<p>Unity provides a solution to support Extended Reality development called <a href="https://docs.unity3d.com/Packages/com.unity.xr.interaction.toolkit@1.0/manual/index.html">XR Interaction Toolkit</a>. From this package, we used the <code>XRRig</code>, <code>InteractionManager</code>, <code>XRController (Action-Based)</code>, <code>XRRayInteractor</code>, <code>XRGrabInteractable</code>, and a few others to enable interaction and navigation in <em>Dive Scenes</em> via the XR controllers.</p>
<p>In <em>ECellDive</em>, every interaction with objects or UI menus is performed remotely thanks to <a href="../UserManual/Controls/ray_based_interaction_controls.html">rays</a> that stems from the base of the controllers and extend for 30 units of distance in the virtual environment. The parameters of the rays are controlled by an <code>XRRayInteractor</code> component attached to the gameobject (GO) representing the ray. In the <code>Player</code> prefab (<code>Assets/Resources/Prefabs/Player</code>) search for the GOs named <code>G Left Ray</code>, <code>RG Left Ray</code>, or <code>RI Left Ray</code> to have examples. A ray interactor works in pair with an interactable in the scenes (e.g. <code>XRGrabInteractable</code>) via an interaction manager (i.e., the <code>XRInteractionManager</code> in the main scene). In <em>ECellDive</em> every module have an <code>XRGrabInteractable</code> and the 2D UI have a <code>TrackedDeviceGraphicRaycaster</code>. The <code>XRRayInteractor</code> and <code>XRGrabInteractable</code> offer a large range of parameters but we mostly don't use them. We only use the pair of components to use <a href="https://docs.unity3d.com/Packages/com.unity.xr.interaction.toolkit@1.0/manual/index.html#update-loop">the interaction detection system implemented in the interaction manager</a> and to bind to events related to this detection such as <code>First/Last Hover</code> (e.g. the <code>XRGrabInteractable</code> of <code>CyJsonModule</code> prefab at <code>Assets/Resources/Prefabs/Modules/CyJsonModules</code>). Then, we implemented our own subsystems such as a customized object movements with the <a class="xref" href="../../api/ECellDive.PlayerComponents.GrabManager.html">GrabManager</a> (in every modules), or a customized player teleportation and continuous movements in <a class="xref" href="../../api/ECellDive.PlayerComponents.MovementManager.html">MovementManager</a> (in <code>MVT Left Container</code> and <code>MVT Right Container</code> in the <code>Player</code> prefab).</p>
<p>We separated the inputs of <em>ECellDive</em> in three sets of action maps for the movements (teleportation &amp; continuous), the ray-based interaction with UI and modules (grab &amp; move, press button), the ray-based and volumetric interactions with modules to make custom groups. Users can switch cycle on them thanks to the component <a class="xref" href="../../api/ECellDive.Input.InputModeManager.html">InputModeManager</a> (in <code>Controllers</code> of the <code>Player</code> prefab). The component exposes access to two fields <a class="xref" href="../../api/ECellDive.Input.InputModeManager.html#ECellDive_Input_InputModeManager_refLeftControlSwitch">refLeftControlSwitch</a> and <a class="xref" href="../../api/ECellDive.Input.InputModeManager.html#ECellDive_Input_InputModeManager_refRightControlSwitch">refRightControlSwitch</a> to specify which action will trigger the input mode cycle on the respective controller. In turn, the action are listening to buttons of the controllers. Hence, when the user press the corresponding button, the action is performed which leads to execution of <a class="xref" href="../../api/ECellDive.Input.InputModeManager.html#ECellDive_Input_InputModeManager_LeftControllerModeSwitch_InputAction_CallbackContext_">LeftControllerModeSwitch</a> or <a class="xref" href="../../api/ECellDive.Input.InputModeManager.html#ECellDive_Input_InputModeManager_RightControllerModeSwitch_InputAction_CallbackContext_">RightControllerModeSwitch</a>. Those two methods respectively increment the <a class="xref" href="../../api/ECellDive.Input.InputModeManager.html#ECellDive_Input_InputModeManager_leftControllerModeID">leftControllerModeID</a> and <a class="xref" href="../../api/ECellDive.Input.InputModeManager.html#ECellDive_Input_InputModeManager_rightControllerModeID">rightControllerModeID</a>: the ray-based controls are associated with value <code>0</code>, the movement controls with value <code>1</code>, and the group controls with value <code>2</code>. From <code>2</code>, the value cycles to <code>0</code>. <a class="xref" href="../../api/ECellDive.Input.InputModeManager.html#ECellDive_Input_InputModeManager_leftControllerModeID">leftControllerModeID</a> and <a class="xref" href="../../api/ECellDive.Input.InputModeManager.html#ECellDive_Input_InputModeManager_rightControllerModeID">rightControllerModeID</a> are network variables which changes trigger the network event <code>OnValueChanged</code> to which the methods <a class="xref" href="../../api/ECellDive.Input.InputModeManager.html#ECellDive_Input_InputModeManager_ApplyLeftControllerActionMapSwitch_System_Int32_System_Int32_">ApplyLeftControllerActionMapSwitch</a>, <a class="xref" href="../../api/ECellDive.Input.InputModeManager.html#ECellDive_Input_InputModeManager_ApplyLeftControllerInteractorsSwitch_System_Int32_System_Int32_">ApplyLeftControllerInteractorsSwitch</a>, <a class="xref" href="../../api/ECellDive.Input.InputModeManager.html#ECellDive_Input_InputModeManager_ApplyRightControllerActionMapSwitch_System_Int32_System_Int32_">ApplyRightControllerActionMapSwitch</a> and <a class="xref" href="../../api/ECellDive.Input.InputModeManager.html#ECellDive_Input_InputModeManager_ApplyRightControllerInteractorsSwitch_System_Int32_System_Int32_">ApplyRightControllerInteractorsSwitch</a> have respectively subscribed. Finally, in those methods, the action maps and interactors the previous <a class="xref" href="../../api/ECellDive.Input.InputModeManager.html#ECellDive_Input_InputModeManager_leftControllerModeID">leftControllerModeID</a> or <a class="xref" href="../../api/ECellDive.Input.InputModeManager.html#ECellDive_Input_InputModeManager_leftControllerModeID">leftControllerModeID</a> are deactivated while the ones of the new value are activated. Finally, the information tags of the buttons are updated to match the new input mode.</p>
<img src="../../resources/diagrams/uiSwitchInputMode.svg" alt="UI Switch Input Mode">
<h2 id="2d-ui-menus">2D UI menus</h2>
<p>All 2D UI panel menus are hand-made. Until this point during development, it has been more cost-efficient to duplicate already existing 2D UI items than to spend time making a procedural script that could generate some base menus. As a consequence there is quite a number of 2D UI items in the projects that resemble each other and have only been slightly modified.</p>
<h3 id="in-the-ui-folder">In the UI folder</h3>
<p>The UI menus are at the path <code>Assets/Resources/UI</code>.</p>
<img src="../../resources/images/dev/UIAssets/UIAssets.jpg" alt="UI Assets" style="width: 300px;">
<ul>
<li>The <code>External Object Container</code> is the prefab holding the <a class="xref" href="../../api/ECellDive.UI.GUIManager.html">GUIManager</a> that is mandatory for our the Main scene.</li>
<li><code>Info Display</code> is an example of a 2D UI panel with a <code>LineRenderer</code> that can make a connection with another object to make them seem attached and related. That's what is used on the demonstration gameobject (GO) <code>BaseModule</code> found at <code>Assets/Resources/Modules</code></li>
<li><code>Info Tag</code> is a specialization of <code>Info Display</code> to inform about the actions bound to the buttons of the XR controllers. It has the component <a class="xref" href="../../api/ECellDive.UI.InfoTagManager.html">InfoTagManager</a> to control its content based on the current input mode of the controller.</li>
<li><code>Picker 2.0 VR</code> is color picker downloaded from the Unity Asset Store adapted to work in an XR scene.</li>
<li><code>Picker 2.0 VR Holder</code> is simply a <code>Picker 2.0 VR</code> encapsulated into a GO that can react to user's interaction to move it (<a href="xred:ECellDive.PlayerComponents.GrabManager">GrabManager</a>) and automatically rotate to be readable from the point of view of the user (<a class="xref" href="../../api/ECellDive.Utility.FaceCamera.html">FaceCamera</a>). This one should probably be deleted and replaced with a compound scene GO made from the <code>Picker 2.0 VR</code> and <code>UI Graphics Holder</code>.</li>
<li><code>Surge Info Tag</code> is a specialized info tag with a <em>surge and shrink</em> animation. It is used on the left and right controllers to momentarily inform the users about the input mode they are switching to.</li>
<li><code>UI Graphics Holder</code> is a container prefab in which to put (as child) 2D UI panels that users can move and should automatically face the user to be readable.</li>
</ul>
<h3 id="in-the-uielements-folder">In the UI/Elements folder</h3>
<p>In this folder are some smaller 2D UI elements that are used to make bigger 2D UI menus.</p>
<img src="../../resources/images/dev/UIAssets/ElementsAssets.jpg" alt="Elements UI" style="width: 300px;">
<ul>
<li><code>Button Scroll List</code> is an vertical UI with a scroll bar in which <code>Menu Button</code> can be instantiated. It uses <a class="xref" href="../../api/ECellDive.UI.OptimizedVertScrollList.html">OptimizedVertScrollList</a> to be able to display a lot of elements while limiting performance hit (<strong>but needs further improvements</strong>).</li>
<li><code>Close Button</code> is a small square cross button that can be use to suggest a way to close 2D UI menus or destroy modules.</li>
<li><code>Drop Down Field</code> is a button with a name and an arrow sign that switches orientation on button click to suggest that some content can be opened/closed.</li>
<li><code>Drop Down Scroll List</code> is an vertical UI with a scroll bar in which <code>Drop Down Field</code> can be instantiated. It uses <a class="xref" href="../../api/ECellDive.UI.OptimizedVertScrollList.html">OptimizedVertScrollList</a> to be able to display a lot of elements while limiting performance hit (<strong>but needs further improvements</strong>).</li>
<li><code>Group Field</code> is specialized to display groups in a list. It is a composition of a <code>Close Button</code> (to destroy the group), a toggle (to show/hide the group), a color button (triggers opening the <code>Picker 2.0 VR Holder</code> to chose the color of the group)</li>
<li><code>Groups Scroll List</code> is an vertical UI with a scroll bar in which <code>Group Field</code> can be instantiated. It uses <a class="xref" href="../../api/ECellDive.UI.OptimizedVertScrollList.html">OptimizedVertScrollList</a> to be able to display a lot of elements while limiting performance hit (<strong>but needs further improvements</strong>).</li>
<li><code>Menu Button</code> is a basic button. Just added a <a class="xref" href="../../api/ECellDive.UI.UIHover.html">UIHover</a></li>
<li><code>Named Input Field</code> &amp; <code>Named Input Field 2</code> are a composition of a text mesh on the left and an input field on the right. The main difference is the appearance: they have different default values of <code>Pixel Per Unit Multiplier</code> in the <code>Image</code> components.</li>
<li><code>Position Handle</code> is the prefab to the white horizontal bar handle that is present on almost every other 2D UI to allow user to move the 2D UI they are part of.</li>
<li><code>Semantic Group Field</code> is a specialized <code>Group Field</code> to represent every groups that were grouped using a specific semantic.</li>
<li><code>Semantics Groups Scroll List</code> is an vertical UI with a scroll bar in which <code>Semantic Group Field</code> can be instantiated. It uses <a class="xref" href="../../api/ECellDive.UI.OptimizedVertScrollList.html">OptimizedVertScrollList</a> to be able to display a lot of elements while limiting performance hit (<strong>but needs further improvements</strong>).</li>
<li><code>Slider Value Color Combo</code> is a composition of a name, a slider, a field to display the value, <code>+</code> and <code>-</code> button to slowly increment or decrement the value, and a color button to assign a color to this value. Two <code>Slider Value Color Combo</code> are used to linearly map a range of values between colors.</li>
<li><code>Slider Value Control</code> is a composition of a name, a slider, a field to display the value, <code>+</code> and <code>-</code> button to slowly increment or decrement the value. It is used to control numerical values.</li>
<li><code>Toggle Field</code> is a composition of a toggle on the left and a name on the right.</li>
<li><code>Toggle Scroll List</code> is an vertical UI with a scroll bar in which <code>Toggle Field</code> can be instantiated. It uses <a class="xref" href="../../api/ECellDive.UI.OptimizedVertScrollList.html">OptimizedVertScrollList</a> to be able to display a lot of elements while limiting performance hit (<strong>but needs further improvements</strong>).</li>
</ul>
<p>All scroll lists could certainly be refactored into one.</p>
<h3 id="in-the-uimenu-elements">In the UI/Menu Elements</h3>
<p>In this folder are 2D UI composed by elements found in <code>UI/Elements</code>.</p>
<img src="../../resources/images/dev/UIAssets/MenuElementsAssets.jpg" alt="Menu Elements UI" style="width: 300px;">
<ul>
<li><code>Buttons Menu</code> is a composition of <code>Button Scroll List</code> with a <code>Position Handle</code>, a name, a <code>Close Button</code> and a pin/unpin pair of buttons.</li>
<li><code>Drop Down Menu</code> is a composition of <code>Drop Down Scroll List</code> with a <code>Position Handle</code>, a name, a <code>Close Button</code> and a pin/unpin pair of buttons. Clicking a <code>Drop Down Field</code> in the scroll list will spawn a <code>Buttons Menu</code> with the content associated to the drop down.</li>
<li><code>Groups Menu</code> is a composition of <code>Groups Scroll List</code> with a <code>Position Handle</code>, a name, a <code>Close Button</code> and a pin/unpin pair of buttons.</li>
<li><code>Log Menu</code> is the menu where users can consult log messages. It is a composition of a <code>Button Scroll List</code>, a wide message space, toggles to control the visibility of the messages, a <code>Close Button</code> and a pin/unpin pair of buttons. <a class="xref" href="../../api/ECellDive.UI.LogManager.html">LogManager</a> is attached to the root GO.</li>
<li><code>Main Menu</code> is a a custom display of buttons to open other menus. <a class="xref" href="../../api/ECellDive.UI.MainMenuManager.html">MainMenuManager</a> is attached to the root GO.</li>
<li><code>Modules Menu</code> is a a custom display of buttons to spawn modules. <a class="xref" href="../../api/ECellDive.UI.ModulesMenuManager.html">ModulesMenuManager</a> is attached to the root GO.</li>
<li><code>Multiplayer Menu</code> is a composition of various input fields and buttons to enter information about the multiplayer server to host or join. <a class="xref" href="../../api/ECellDive.UI.ModulesMenuManager.html">MultiplayerMenuManager</a> is attached to the root GO.</li>
<li><code>Semantic Groups Menu</code> is a composition of <code>Semantic Groups Scroll List</code> with a <code>Position Handle</code>, a name, a <code>Close Button</code> and a pin/unpin pair of buttons. <a class="xref" href="../../api/ECellDive.UI.GroupsMenu.html">GroupsMenu</a> is attached to the root GO.</li>
<li><code>Short Demo Menu</code> i is a a custom display of button to switch between aspects of the demo, to reset the visuals, or to quit the demo.</li>
<li><code>Toggles Menu</code> is a composition of <code>Toggle Scroll List</code> with a <code>Position Handle</code>, a name, a <code>Close Button</code> and a pin/unpin pair of buttons.</li>
<li><code>Tutorial Panel</code> is a custom display of buttons and text to give the tutorial instructions.</li>
<li><code>Tutorials Menu</code> is a custom display of buttons to open the tutorials and the demo. The buttons triggers an <em>Unity Scene</em> change so their callbacks must be set in the main scene to use the <a class="xref" href="../../api/ECellDive.SceneManagement.AssetScenesManager.html">AssetScenesManager</a>.</li>
</ul>
<p>Most of the menus are encapsulated in a <code>UI Graphics Holder</code> in the main scene to manage their translations and automatically face the user to be readable.</p>
<h3 id="in-the-uitag-menus">In the UI/Tag Menus</h3>
<p>In this folder are 2D UI elements that are attached to modules. So it is a combination of UI elements and the graphic link system to display a line between the menus and the modules they are attached to. They all use the <a class="xref" href="../../api/ECellDive.UI.InfoDisplayManager.html">InfoDisplayManager</a>.</p>
<img src="../../resources/images/dev/UIAssets/TagMenusAssets.jpg" alt="Tag Menus UI" style="width: 300px;">
<p><code>Anchored Dynamic Content</code> encapsulates a <code>Button Scroll List</code> to display a list of options that may be associated to a module. The rest of the UI panel's names indicate to which module they are part of. <code>FBA Visuals Parameters</code> uses <a class="xref" href="../../api/ECellDive.UI.FbaParametersManager.html">FbaParametersManager</a> and <code>GroupByAttributsDisplay</code> uses <a class="xref" href="../../api/ECellDive.UI.GroupByAttributsManager.html">GroupByAttributsManager</a>.</p>

</article>

        <div class="contribution d-print-none">
          <a href="https://github.com/ecell/ECell_Dive/blob/main/DocFX/articles/Dev/about_UI.md/#L1" class="edit-link">Edit this page</a>
        </div>

        <div class="next-article d-print-none border-top" id="nextArticle"></div>

      </div>

      <div class="affix">
        <nav id="affix"></nav>
      </div>
    </main>


    <footer class="border-top">
      <div class="container-xxl">
        <div class="flex-fill">
          <span>Made with <a href="https://dotnet.github.io/docfx">docfx</a></span>
        </div>
      </div>
    </footer>
  </body>
</html>
